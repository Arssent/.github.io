<html>
   <head>
  
     <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"></script>
  
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<link rel="stylesheet" href="style2.css">
 <style type="text/css">
      #splash {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        align-items: center;
        justify-content: center;
        
        background: rgba(0, 0, 0, 0.7);
        color: white;
        cursor: pointer;
        z-index: 999;
      }
    </style>
<script>
      document.addEventListener("DOMContentLoaded", function(event) {
        var scene = document.querySelector("a-scene");
        var vid = document.getElementById("video");
        var videoShere = document.getElementById("videoShere");
        if (scene.hasLoaded) {
          run();
        } else {
          scene.addEventListener("loaded", run);
        }
        
        function run () {
          if(AFRAME.utils.device.isMobile()) {
            document.querySelector('#splash').style.display = 'flex';
            document.querySelector('#splash').addEventListener('click', function () {
              playVideo();
              this.style.display = 'none';
            })
          } else {
              playVideo();
          }
        }
        
        function playVideo () {
          vid.play();
          videoShere.components.material.material.map.image.play();
        }
      })
    </script>

</head>
  <body style='margin : 0px; overflow: hidden;'>
<meta aframe-injected="" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui">
<meta aframe-injected="" name="mobile-web-app-capable" content="yes">

 <div id="splash">
      <div id="start-button">Start</div>
</div>

<div class="btns-wrap">

	<button disabled="true">Please wait, loading...</button>
</div>
<script>
   alert('goo17');
var WIDTH = 640;
var HEIGHT = 360;
// Interesting parameters to tweak!
var SMOOTHING = 0.8;
var FFT_SIZE = 2048;
function VisualizerSample() {
  this.analyser = context.createAnalyser();
  this.analyser.connect(context.destination);
  this.analyser.minDecibels = -140;
  this.analyser.maxDecibels = 0;
  loadSounds(this, {
    buffer: 'A Thousand Thousandths.mp3'
  }, onLoaded);
  this.freqs = new Uint8Array(this.analyser.frequencyBinCount);
  this.times = new Uint8Array(this.analyser.frequencyBinCount);
  function onLoaded() {
    var button = document.querySelector('button');
    button.removeAttribute('disabled');
    button.innerHTML = 'Play/pause';
  };
  this.isPlaying = false;
  this.startTime = 0;
  this.startOffset = 0;
}
// Toggle playback
VisualizerSample.prototype.togglePlayback = function() {
  if (this.isPlaying) {
    // Stop playback
    this.source[this.source.stop ? 'stop': 'noteOff'](0);
    this.startOffset += context.currentTime - this.startTime;
    console.log('paused at', this.startOffset);
    // Save the position of the play head.
  } else {
    this.startTime = context.currentTime;
    console.log('started at', this.startOffset);
    this.source = context.createBufferSource();
    // Connect graph
    this.source.connect(this.analyser);
    this.source.buffer = this.buffer;
    this.source.loop = true;
    // Start playback, but make sure we stay in bound of the buffer.
    this.source[this.source.start ? 'start' : 'noteOn'](0, this.startOffset % this.buffer.duration);
    // Start visualizer.
    requestAnimFrame(this.draw.bind(this));
  }
  this.isPlaying = !this.isPlaying;
}
VisualizerSample.prototype.draw = function() {
  this.analyser.smoothingTimeConstant = SMOOTHING;
  this.analyser.fftSize = FFT_SIZE;
  // Get the frequency data from the currently playing music
  this.analyser.getByteFrequencyData(this.freqs);
  this.analyser.getByteTimeDomainData(this.times);
  var width = Math.floor(1/this.freqs.length, 10);
  // Draw the frequency domain chart.
 
    var value = this.freqs;
    var percent = value / 256;
 
                //this.BoXx=document.querySelector('#test3');
              // this.Likvid=document.querySelector('#test1');
                
	        var band = Math.floor(percent.random(128));
                var BoXx=document.querySelector('#test3');
                var Likvid=document.querySelector('#test1')
	
                var pulse = Math.exp(band) || 1;
                var X=0.13;
                var Y=0.2;
                var Z=0.132;
                //X=X * pulse;
                Y=Y * pulse *2;
               /// Z=Z * pulse;
                //alert(Y);
             
               
              var lik1X =0.121;
              var lik1Y =0.1;
              var lik1Z =0.1;
             //lik1X=lik1X * pulse;
             // lik1X=lik1Y * pulse;
             //lik1Z=lik1Z * pulse;
                lik1Y=lik1Y * pulse;
               if(Y<=0.5){
               Y=0.1;
                   };
              ///alert(Y);
               if(Y>0.7){
               Y=Y*2;
                   };
               this.BoXx.setAttribute('scale', {x: X, y: Y, z: Z});
               this.Likvid.setAttribute('scale', {x: lik1X, y: lik1Y, z: lik1Z});
	  console.log("& "+ch1+"& "+ch2+"& "+ch3+"& "+ch4+"& "+ch5+"& "+ch6+"& "+ch7+"& "+ch8+"& "+ch9);
}
 
  if (this.isPlaying) {
    requestAnimFrame(this.draw.bind(this));
  }
}
VisualizerSample.prototype.getFrequencyValue = function(freq) {
  var nyquist = context.sampleRate/2;
  var index = Math.round(freq/nyquist * this.freqs.length);
  return this.freqs[index];
}
	
	
	
	
	
</script>
	
<<div class="poster">
<a-scene embedded arjs='sourceType: webcam;'>
  <a-assets>
 <a-asset-item id="MainModel" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2FModelMain.obj"></a-asset-item>
  <a-asset-item id="likvidation1" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation1big.obj"></a-asset-item>
   <a-asset-item id="likvidation2" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation2.obj"></a-asset-item>
       <a-asset-item id="likvidation3" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation3.obj"></a-asset-item>
           <a-asset-item id="likvidation4" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation4.obj"></a-asset-item>
        <a-asset-item id="likvidation5" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation5.obj"></a-asset-item>
    
          <a-asset-item id="likvidation6" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation6.obj"></a-asset-item>
           <a-asset-item id="likvidation7" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation8.obj"></a-asset-item>
    
         <a-asset-item id="likvidation8" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Flikvidation9.obj"></a-asset-item>
    
    <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">>

    <img id="poster" src="https://cdn.glitch.com/6f99ad31-73ac-4760-87fc-7a7af6f64830%2Fposter%20word.jpg">
  </a-assets>
  

<a-entity id="test3" scale="0.13 0.11 0.132" obj-model="obj: #MainModel; " position="-0.360 0.7 -0.86" material="color:white"></a-entity>
  

 
  <a-entity id="test1" scale="0.121 0.1 0.1" obj-model="obj: #likvidation1; " position="-0.5 0.7 -0.74" material="color:red"></a-entity>
   
    <a-entity id="likvidation2" scale="0.121 0.1 0.1" obj-model="obj: #likvidation2; " position="-0.5 0.7 -0.68" material="color:red"></a-entity>
  
      <a-entity id="likvidation3" scale="0.121 0.1 0.1" obj-model="obj: #likvidation3; " position="-0.5 0.7 -0.66" material="color:red"></a-entity>
  
       <a-entity id="likvidation4" scale="0.121 0.1 0.1" obj-model="obj: #likvidation4; " position="-0.5 0.7 -0.61" material="color:red"></a-entity>
  
         <a-entity id="likvidation5" scale="0.121 0.1 0.1" obj-model="obj: #likvidation5; " position="-0.5 0.7 -0.55" material="color:red"></a-entity>
    
         <a-entity id="likvidation6" scale="0.121 0.1 0.1" obj-model="obj: #likvidation6; " position="-0.45 0.7 -0.50" material="color:red"></a-entity>
  
           <a-entity id="likvidation7" scale="0.121 0.1 0.1" obj-model="obj: #likvidation7; " position="-0.52 0.7 -0.43" material="color:red"></a-entity>
  
             <a-entity id="likvidation8" scale="0.121 0.1 0.1" obj-model="obj: #likvidation8; " position="-0.40 0.7 -0.42" material="color:red"></a-entity>
 
 <a-image id="test" src="#poster"  position="0 0.7 0" width="1" height="1.5" rotation='-90 0 0' material="color:black"></a-image>
   
  
<!--  <a-entity  id="posteR" src="#poster" position="0 0.5 0"  geometry="primitive: plane; height: 1.5; width: 1" rotation='-90 0 0'  material="color:black;  side: double;" ></a-entity>-->
  
  
 
 <a-marker-camera preset='hiro'></a-marker-camera>
  
</a-scene>
</div>
	  
 <script src="shared.js"></script>
      
<script>
var sample = new VisualizerSample();
document.querySelector('button').addEventListener('click', function() {
  sample.togglePlayback()
});
</script>
   </body>
</html>
